<?xml version="1.0" encoding="utf-8"?>
<!-- License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).
     © 2015 Grupo ESOC Ingeniería de Servicios, S.L.U. -->

<openerp>
<data>

<record id="event_registration_form" model="ir.ui.view">
    <field name="name">Grades</field>
    <field name="model">event.registration</field>
    <field name="inherit_id" ref="event.view_event_registration_form"/>
    <field name="arch" type="xml">
        <xpath expr="//sheet[@string='Registration']">
            <group string="Training"
                   attrs="{'invisible': [('training_action_id', '=', False)]}">
                <field name="training_action_id"/>
                <field name="grade"/>
                <field name="passing"/>
            </group>
        </xpath>
    </field>
</record>

<!-- Quick search of training groups -->
<record id="event_search" model="ir.ui.view">
    <field name="name">Search training groups</field>
    <field name="model">event.event</field>
    <field name="inherit_id" ref="event.view_event_search"/>
    <field name="arch" type="xml">
        <data>
            <xpath expr="//group[@string='Group By']" position="before">
                <separator/>
                <!-- Search by training action -->
                <field name="training_action_id"/>

                <!-- Show only training groups -->
                <filter name="training_groups"
                        string="Training groups"
                        help="Show only events considered training groups"
                        domain="[('training_action_id', '!=', False)]"/>
            </xpath>
            <xpath expr="//group[@string='Group By']">
                <!-- Goup by training action -->
                <filter string="Training action"
                        help="Group event by training action"
                        context="{'group_by': 'training_action_id'}"/>
            </xpath>
        </data>
    </field>
</record>

<!-- Action to open a filtered view of training group events only -->
<record id="open_training_groups_view" model="ir.actions.act_window">
    <field name="name">Training groups</field>
    <field name="res_model">event.event</field>
    <field name="view_mode">kanban,calendar,tree,form</field>
    <field name="context">{
        "search_default_training_groups": True,
        "training_mode": True,
    }</field>
    <field name="help" type="html">
        <p class="oe_view_nocontent_create">
            Click to add a new training group.
        </p>
        <p>
            Training groups are in really events, when you set a training
            action for them. You can do everything as with an event.
        </p>
    </field>
</record>

<menuitem id="training_groups_menu"
          parent="catalog_menu"
          groups="user_group"
          name="Groups"
          action="open_training_groups_view"/>

</data>
</openerp>
