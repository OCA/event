<?xml version="1.0" encoding="utf-8"?>
<!-- License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl.html).
     © 2015 Grupo ESOC Ingeniería de Servicios, S.L.U. - Jairo Llopis -->

<openerp>
<data>

<!-- Templates -->
<template id="attendance_certificate_report">
    <t t-call="report.html_container">
        <t t-foreach="doc_ids" t-as="doc_id">
            <t t-raw="translate_doc(
                doc_id, doc_model, 'lang',
                'event_training.attendance_certificate_report_translatable')"/>
        </t>
    </t>
</template>

<template id="attendance_certificate_report_translatable">
    <t t-call="report.external_layout">
        <div class="page">
            <h1>Training Attendance Certificate</h1>
            <t t-set="courses"
               t-value="(o | o.child_ids)
                        .mapped('registrations.event_id.product_id')
                        .filtered('is_training')"/>
            <t t-if="o.is_company and o.child_ids">
               <t t-call="event_training.attendance_certificate_company"/>
            </t>
            <t t-if="not (o.is_company and o.child_ids)">
               <t t-call="event_training.attendance_certificate_contact"/>
            </t>
        </div>
    </t>
</template>

<template id="attendance_certificate_contact">
    <p>
        This document certifies that
        <strong>
            <t t-if="o and o.title"
               t-esc="o.title.shortcut or
                      o.title.name"/>
            <t t-esc="o.name"/>
        </strong>
        <t t-if="courses">
            participated in some of our training groups according to the
            following information:
        </t>
        <t t-if="not courses">
            participated in none of our training groups.
        </t>
    </p>

    <t t-if="courses">
        <t t-set="contact" t-value="o"/>
        <t t-call="event_training.attendance_certificate_table"/>
    </t>
</template>

<template id="attendance_certificate_company">
    <p>
        This document certifies that
        <t t-if="courses">
            the following people participated in the name of
            <strong t-esc="o.display_name"/>
            in some of our training groups,
            and according to the following information:
        </t>
        <t t-if="not courses">
            nobody participated in any of our training groups in the name of
            <strong t-esc="o.display_name"/>.
        </t>
    </p>

    <div t-if="courses" t-foreach="o | o.child_ids" t-as="contact">
        <t t-if="contact.mapped('registrations.event_id.product_id')">
            <h3>
                <small t-if="contact and contact.title"
                       t-esc="contact.title.shortcut or
                              contact.title.name"/>
                <t t-esc="contact.name"/>
            </h3>
            <t t-call="event_training.attendance_certificate_table"/>
        </t>
    </div>
</template>

<template id="attendance_certificate_table">
    <table class="table">
        <thead>
            <tr>
                <th>Training</th>
                <th>Dates</th>
                <th>Status</th>
                <th>Grade</th>
            </tr>
        </thead>
        <tbody>
            <t t-foreach="contact.registrations" t-as="r">
                <tr t-if="r.event_id.product_id">
                    <td t-esc="r.event_id.product_id.name"/>
                    <td>
                        From <t t-esc="r.event_id.date_begin"/><br/>
                        to <t t-esc="r.event_id.date_end"/>
                    </td>
                    <td t-esc="dict(r.fields_get()['state']['selection'])
                              .get(r.state)"/>
                    <td>
                        <t t-if="r.passing">Passed</t>
                        <t t-if="not r.passing">Failed</t>
                    </td>
                </tr>
            </t>
        </tbody>
    </table>
</template>

<!-- Report action -->
<report
    id="attendance_certificate_action"
    model="res.partner"
    name="event_training.attendance_certificate_report"
    string="Training Attendance Certificate"
    report_type="qweb-pdf"
    groups="group_user"
    multi="False"/>

</data>
</openerp>
